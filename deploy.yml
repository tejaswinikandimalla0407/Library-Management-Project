apiVersion: apps/v1
kind: Deployment
metadata:
  name: Library-app
spec:
  replicas: 2
  selector:
   matchLabels:
     app: Library-app
  template:
   metadata:
     labels:
       app: Library-app
     annotations:
       ad.datadoghq.com/Library-app.logs: '[{"source":"nodejs","service":"Library-service"},{"source":"nodejs","service":"Library-app"}]'
   spec:
     containers:
     - name: Library-app
       image: swargamsai/library-app-doc-img:latest
       ports:
       - containerPort: 3000
       env:
       - name: MONGODB_URI
         value: "mongodb://localhost:27017/parceltracker"
       - name: PORT
         value: "3000"
       - name: HOST
         value: "0.0.0.0"
       - name: NODE_ENV
         value: "production"
       # Datadog APM (tracing) env variables
       - name: DD_AGENT_HOST
         valueFrom:
           fieldRef:
             fieldPath: status.hostIP
       - name: DD_TRACE_AGENT_PORT
         value: "8126"
       - name: DD_ENV
         value: "production"
       - name: DD_SERVICE
         value: "Library-app"
       - name: DD_VERSION
         value: "1.0.0"
---
apiVersion: v1
kind: Service
metadata:
  name: Library-service
spec:
  selector:
   app: Library-app
  ports:
  - port: 8070
   targetPort: 3000
  type: LoadBalancer
 